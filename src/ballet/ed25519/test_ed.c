#include <stdio.h>
#include "../txn/fd_txn.h"
#include "../fd_ballet.h"
uchar txn[215] = {
0x01,0x9e,0x12,0xf0,0xf9,0x16,0x16,0x64,0x2f,0x81,0x49,0x72,0x6b,0x48,0x95,0x08,
0xff,0xbf,0xd0,0x3d,0x7c,0x38,0xb0,0x39,0x25,0x4f,0xf4,0x0d,0x93,0x11,0x5d,0x83,
0x45,0xbb,0xbd,0x15,0x43,0xac,0xc4,0xbe,0xd9,0x12,0xc8,0xae,0xe2,0x45,0x79,0x08,
0x73,0x81,0x0a,0xa7,0xe3,0x8b,0xed,0x31,0x5f,0xbd,0xec,0x2f,0x30,0x46,0x8b,0xc5,
0x08,0x01,0x00,0x01,0x03,0x82,0x68,0xf1,0xa9,0xdb,0x24,0x3e,0x21,0x14,0x68,0x57,
0xf5,0x95,0xc0,0x8c,0xf1,0x8f,0x4b,0x85,0xe8,0xb2,0x62,0xe8,0x00,0xb7,0x21,0x9f,
0x45,0x68,0xe3,0x02,0x0d,0x16,0x24,0x6a,0xb0,0x93,0x0e,0xa6,0x36,0x26,0x13,0xa4,
0x2e,0x94,0xf1,0x81,0xa2,0x6a,0xa5,0x40,0x29,0xc6,0xd6,0xf4,0xff,0xf5,0xab,0x39,
0xd4,0x7d,0x7b,0xee,0xed,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x02,0x00,0x01,0x0c,0x02,0x00,0x00,0x00,0x06,
0xd1,0x5b,0x7c,0xbe,0x36,0x4c,0x6c};

uchar scratch[1024];
int
main( int     argc,
      char ** argv ) {
  fd_boot( &argc, &argv );
  //fd_rng_t _rng[1]; fd_rng_t * rng = fd_rng_join( fd_rng_new( _rng, 0U, 0UL ) );
  fd_sha512_t _sha[1]; fd_sha512_t * sha = fd_sha512_join( fd_sha512_new( _sha ) );

  ulong parse = fd_txn_parse( txn, 215UL, scratch, NULL );
  fd_txn_t * txnt = (fd_txn_t*) scratch;
  FD_TEST( parse>0UL );
  printf("message = ");
  for (ulong i = 0; i < 215UL-txnt->message_off; ++i) {
    printf("%.2hhx ", txn[txnt->message_off + i]);
  }
  printf("\n");
  printf("sig R = ");
  for (int i = 0; i < 32; ++i) {
    printf("%.2hhx ", txn[txnt->signature_off + i]);
  }
  printf("\n");
  printf("sig s = ");
  for (int i = 32; i < 64; ++i) {
    printf("%.2hhx ", txn[txnt->signature_off + i]);
  }
  printf("\n");
  printf("pubkey k = ");
  for (int i = 0; i < 32; ++i) {
    printf("%.2hhx ", txn[txnt->acct_addr_off + i]);
  }
  printf("\n");
  FD_TEST( 0==fd_ed25519_verify( txn+txnt->message_off, 215UL-txnt->message_off, txn+txnt->signature_off, txn+txnt->acct_addr_off, sha ) );
}
